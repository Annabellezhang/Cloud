blogs=blogs||{};$.extend(true,blogs,{messages:{en:{invalidEmailAddresses:"Invalid email addresses: ",pleaseEnterEmailAddreses:"Please enter email addresses.",commentSuccess:"Your comment was posted successfully.",commentFailure:"Your comment was not posted. Please try again later.",commentTooLong:"Comment length greater than allowed limit.",noComment:"Please type a comment.",eof:""},cn:{invalidEmailAddresses:"(cn) Invalid email addresses: ",pleaseEnterEmailAddreses:"(cn) Please enter email addresses.",commentSuccess:"(cn) Your comment was posted successfully.",commentFailure:"(cn) Your comment was not posted. Please try again later.",commentTooLong:"(cn) Comment length greater than allowed limit.",noComment:"(cn) Please type a comment.",eof:""}}});blogs.msgs=function(locale){locale=locale||document.body.lang||"en";return blogs.messages[locale]||blogs.messages["en"];};var blogs=blogs||{};blogs.url={post:function(options){return blogs.url.template("/post/{postID}",options,"postID");},blog:function(options){return blogs.url.template("/",options);},archive:function(options){return blogs.url.template("/blog/archive/{year}/{month}/{day}",options);},template:function(template,opts,lift){var options=opts;if(lift&&!(typeof opts=="object")){options={};options[lift]=opts;}var expr=/{(\w+)}/;var match;while(match=template.match(expr)){var result=template.replace(expr,options[match[1]]||"");if(template==result){break;}template=result;}return template.replace(/\/{2,}/,"/");}};$(document).ready(function(){$("form.blog-ux-ajax-post").submit(function(e){var data={};var actionUrl=$(this).attr("action");$(this).addClass("loading");$(this).serializeArray().map(function(e){data[e.name]=e.value;});$.ajax({url:actionUrl,type:"POST",data:data,context:this,success:function(result){var msg=blogs.msgs();if(result=="true"){reloadCommentPage(-1);$("#postCommentForm").replaceWith('<h4 id="newComment"></h4>').text(msg.commentSuccess);}else{reloadCommentPage(-1);$("#postCommentForm").replaceWith('<h4 id="newComment"></h4>').text(msg.commentFailure);}}});e.preventDefault();return false;});function reloadCommentPage(newPage){var container=$(".blog-ux-ajax-comments");var paging=container.find("nav.paging");var pageSize=paging.attr("data-page-size");var currentPage=paging.attr("data-current-page");var rootDir=paging.attr("data-root-dir");var isPostComment=newPage<0;if(newPage==currentPage){return;}else{if(isPostComment){newPage=Math.ceil((1+parseInt(paging.attr("data-total-items")))/parseInt(pageSize));}}var url="/blog/comment/detailList";if(rootDir){url="/"+rootDir+"/blog/comment/detailList";}$.post(url,{postID:container.attr("data-post-id"),number:newPage,size:pageSize},function(data){container.html(data);var totalComments=$(".paging").attr("data-total-items");$("#commentNumber").html(totalComments);});}$(".blog-ux-ajax-comments .paging a").live("click",function(e){e.stopPropagation();e.preventDefault();reloadCommentPage($(this).attr("data-page"));});});var blogs=blogs||{};blogs.archiveModule=function(options){var self=this;$.extend(self,{year:function(){return self.valIndirect(self.yearSelect,arguments);},month:function(){return self.valIndirect(self.monthSelect,arguments);},day:function(){return self.valIndirect(self.daySelect,arguments);},valIndirect:function(e,args){var result=$.prototype.val.apply(e,args);return parseInt(e.val());},updateDropdowns:function(){var daysInMonth=32-new Date(self.year(),self.month()-1,32).getDate();var currentDay=self.day();var now=new Date();self.daySelect.find("option:not(.default)").remove();for(var day=1;day<=daysInMonth;day++){self.daySelect.append($("<option />").html(day).attr("value",day));}self.daySelect.val(Math.min(daysInMonth,currentDay));},initialize:function(options){var opts=$.extend({},blogs.archiveModule.defaults,options);var module=self.module=$(opts.module);var month=self.monthSelect=module.find(opts.monthSelect);var day=self.daySelect=module.find(opts.daySelect);var year=self.yearSelect=module.find(opts.yearSelect);var submitButton=self.submitButton=module.find(opts.submitButton);submitButton.click(function(){if(self.day()&&(!self.month()||!self.year())){self.yearSelect.toggleClass("error",!self.year());self.monthSelect.toggleClass("error",!self.month());}else{if(self.month()&&!self.year()){self.yearSelect.addClass("error");}else{window.location=blogs.url.archive({year:self.year()||undefined,month:self.month()||undefined,day:self.day()||undefined});}}});year.bind("change blur",function(){self.year();if(!opts.ignoreDay){self.updateDropdowns();}});day.mousedown(function(){if(self.month()==0){var now=new Date();self.month(now.getMonth()+1);self.monthSelect.blur();}});day.bind("change blur",function(){self.day();});month.bind("change blur",function(){if(self.year()==0){var now=new Date();var pickYear=now.getFullYear();if($(this).val()-1>now.getMonth()){pickYear--;}self.year(pickYear);}if(!opts.ignoreDay){self.updateDropdowns();}});self.module.attr("data-module-initialized","1");return self;}});return self.initialize(options);};blogs.archiveModule.defaults={module:"#archiveModule",yearSelect:"select.year",monthSelect:"select.month",daySelect:"select.day",submitButton:"button",ignoreDay:false};var blogs=blogs||{};blogs.searchModule=function(options){var self=this;$.extend(self,{category:function(){return self.valIndirect(self.categorySelect,arguments);},query:function(){return self.valIndirect(self.queryInput,arguments);},submit:function(){return self.form.submit();},initialize:function(options){var opts=$.extend({},blogs.searchModule.defaults,options);var module=self.module=$(opts.module);var category=self.categorySelect=module.find(opts.categorySelect);var query=self.queryInput=module.find(opts.queryInput);self.form=module.find("form");category.bind("change blur",function(){$("#selectedCategory").text($(this).find(":selected").text());});self.module.attr("data-module-initialized","1");return self;},valIndirect:function(e,args){$.prototype.val.apply(e,args);return e.val();}});return self.initialize();};blogs.searchModule.defaults={module:"#searchModule",categorySelect:"select.category",queryInput:"input.query"};(function($){function BlogSharePostForm(){}$.extend(BlogSharePostForm.prototype,{_init:function(target,opts){var $target=$(target),self=this,button=$(target).find("button");this.emailAddresses=$target.find(".email-addresses");this.emailAddressesSummary=$target.find(".email-addresses-summary");this.invalidContent=$target.find(".invalid-content");button.click(function(e){var text=self.emailAddresses.val();var items=text.split(",");var msg=blogs.msgs();if(!text){self.emailAddressesSummary.text(msg.pleaseEnterEmailAddreses);self.emailAddressesSummary.show();self.invalidContent.show();return false;}var invalid=$(items).map(function(i,e){var match=e.match(/\w+([\.-]\w+)*@\w+([\.-]\w+)*\.\w{2,}/);return match?undefined:$.trim(e);}).toArray();var isInvalid=invalid.length;if(isInvalid){self.emailAddressesSummary.text(msg.invalidEmailAddresses+invalid.join(","));}self.emailAddressesSummary[isInvalid?"show":"hide"]();self.invalidContent[isInvalid?"show":"hide"]();return !isInvalid;});}});$.blogSharePostForm=new BlogSharePostForm();$.fn.blogSharePostForm=function(options){return this.each(function(){$.blogSharePostForm._init(this,options);});};})(jQuery);